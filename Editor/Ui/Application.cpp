#include <stdafx.h>
#include "Application.h"
#include "MainFrame.h"
#include "Msg/MsgDispatcher.h"
#include "Core/Commander.h"
#include "Core/FileMgr.h"
#include "Utils/SafeDel.h"

///////////////////////////////////////////////////////////////////////////////
IMPLEMENT_APP(Application)
static Application* appInstance_;

///////////////////////////////////////////////////////////////////////////////
Application* Application::Instance()
{
	return appInstance_;
}

///////////////////////////////////////////////////////////////////////////////
bool Application::OnInit()
{
	::wxInitAllImageHandlers();

	appInstance_ = this;
	dispatcher_ = new MsgDispatcher();
	commander_ = new Commander();
	fileMgr_ = new FileMgr();

	main_ = new MainFrame(wxT("Editor"));
	main_->Show(true);

	return true;
}

///////////////////////////////////////////////////////////////////////////////
int Application::OnExit()
{	
	SafeDel(fileMgr_);
	SafeDel(commander_);
	SafeDel(dispatcher_);

	main_ = nullptr;
	appInstance_ = nullptr;

	return 0;
}

///////////////////////////////////////////////////////////////////////////////
MsgDispatcher* Application::GetMsgDispatcher()
{
	return dispatcher_;
}

///////////////////////////////////////////////////////////////////////////////
Commander* Application::GetCommander()
{
	return commander_;
}

///////////////////////////////////////////////////////////////////////////////
FileMgr* Application::GetFileMgr()
{
	return fileMgr_;
}

///////////////////////////////////////////////////////////////////////////////

///////////////////////////////////////////////////////////////////////////////
MsgDispatcher* GetMsgDispatcher()
{
	return Application::Instance()->GetMsgDispatcher();
}

///////////////////////////////////////////////////////////////////////////////
Commander* GetCommander()
{
	return Application::Instance()->GetCommander();
}

///////////////////////////////////////////////////////////////////////////////
FileMgr* GetFileMgr()
{
	return Application::Instance()->GetFileMgr();
}

///////////////////////////////////////////////////////////////////////////////